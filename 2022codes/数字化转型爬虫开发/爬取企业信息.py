import requests
import js2py
import time

def saveInfo(result):
    """
    :param result:
    :return:
    """
    with open("result.txt", "a") as f:
        f.write(result+'\n')


def getmcode():
    context = js2py.EvalJs(enable_require=True)
    with open("juchaozixun.js", 'r', encoding='utf8') as f:
        result = f.read()
    context.execute(result)
    return context.getResCode()


url='http://webapi.cninfo.com.cn/api/sysapi/p_sysapi1018?'
headers = {
    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/109.0.0.0 Safari/537.36',
    "Cookie": f"Hm_lvt_489bd07e99fbfc5f12cbb4145adb0a9b={int(time.time())}; Hm_lpvt_489bd07e99fbfc5f12cbb4145adb0a9b={int(time.time())}",
    "Host": "webapi.cninfo.com.cn",
    "mcode": getmcode(),
    "Origin": "http://webapi.cninfo.com.cn",
    "Referer": "http://webapi.cninfo.com.cn/",
}
scodes= [
    "000035,000301,000421,000425,000518,000525,000551,000570,000581,000584,000626,000681,000700,000727,000738,000777,000816,000890,000910,000919",
    "830946,831641,831834,832089,832278,832662,832735,832802,833509,833533,833914,834014,834950,835305,835857,836149,836422,836720,837046,837663,838262,839167,839371,839790,870204,870299,870436,871245,871396,871642,872392,873339,900921",
    "000936,000961,001205,001234,001236,001332,002002,002009,002015,002024,002040,002044,002075,002077,002079,002080,002081,002089,002090,002091,002104,002127,002150,002156,002160,002165,002172,002182,002201,002221,002223,002239,002245,002255,002262,002274,002290,002293,002304,002309,002315,002333,002349,002367,002380,002384,002387,002391,002394,002395",
    "002409,002413,002426,002435,002438,002445,002453,002455,002463,002471,002478,002483,002484,002491,002496,002499,002513,002514,002516,002519,002530,002531,002540,002546,002547,002550,002553,002559,002564,002576,002585,002608,002610,002623,002631,002635,002645,002652,002685,002692,002708,002722,002734,002747,002778,002787,002796,002802,002807,002808",
    '002839,002866,002877,002883,002947,002966,002976,002998,003015,003032,003043,200468,200570,200581,300029,300031,300091,300128,300135,300141,300160,300165,300169,300172,300190,300192,300196,300201,300211,300215,300217,300228,300240,300258,300260,300261,300265,300279,300284,300292,300295,300304,300305,300320,300331,300337,300339,300342,300346,300354',
    "300356,300373,300382,300385,300390,300393,300394,300402,300416,300420,300421,300429,300447,300450,300466,300500,300507,300509,300522,300528,300537,300549,300554,300555,300563,300575,300580,300584,300585,300598,300600,300610,300617,300618,300623,300631,300641,300644,300651,300655,300660,300664,300670,300680,300682,300694,300697,300707,300708,300709",
    "300715,300717,300721,300725,300742,300751,300753,300757,300761,300777,300782,300798,300806,300809,300819,300826,300827,300836,300842,300855,300856,300864,300873,300881,300885,300905,300907,300912,300926,300927,300931,300933,300936,300952,300959,300964,300970,300975,300982,301003,301006,301010,301012,301016,301023,301026,301030,301036,301040,301045",
    "301058,301061,301063,301072,301076,301078,301088,301090,301093,301098,301101,301106,301115,301116,301122,301125,301137,301155,301160,301163,301168,301179,301180,301181,301186,301187,301195,301215,301220,301226,301229,301238,301258,301260,301266,301278,301285,301290,301339,301378,301389,430418,600064,600078,600083,600099,600105,600122,600128,600200",
    "600213,600220,600250,600268,600276,600280,600282,600287,600300,600305,600327,600370,600377,600389,600398,600400,600406,600475,600481,600486,600487,600501,600510,600513,600522,600527,600533,600557,600562,600584,600667,600682,600710,600713,600716,600736,600746,600770,600775,600794,600805,600844,600854,600862,600889,600901,600908,600919,600959,600970",
    "600973,600981,601007,601008,601009,601010,601100,601128,601155,601199,601218,601222,601388,601456,601500,601512,601555,601688,601700,601799,601860,601890,601928,601952,601975,601990,603005,603007,603013,603016,603017,603018,603028,603035,603036,603041,603042,603052,603059,603065,603066,603078,603090,603097,603111,603115,603117,603133,603136,603155",
    "603158,603161,603163,603179,603183,603185,603188,603201,603203,603206,603212,603221,603259,603269,603283,603286,603291,603299,603307,603313,603323,603326,603332,603339,603351,603355,603358,603359,603366,603369,603380,603387,603389,603416,603486,603488,603489,603507,603518,603519,603528,603530,603585,603626,603629,603655,603660,603666,603680,603688",
    "603693,603699,603707,603722,603776,603787,603800,603810,603819,603828,603829,603876,603878,603879,603880,603890,603900,603906,603912,603915,603916,603922,603928,603929,603937,603955,603958,603966,603968,603982,603985,603988,603990,605058,605089,605099,605111,605123,605133,605167,605183,605218,605258,605286,605288,605298,605300,605319,605333,605376",
    "605389,605588,688001,688003,688013,688017,688022,688029,688030,688046,688048,688052,688055,688060,688069,688076,688093,688096,688097,688103,688105,688106,688113,688116,688137,688147,688166,688170,688176,688178,688182,688186,688192,688205,688211,688218,688221,688225,688226,688231,688232,688257,688258,688259,688260,688261,688262,688266,688273,688286",
    "688295,688300,688329,688337,688350,688353,688355,688358,688371,688375,688376,688377,688381,688386,688390,688396,688399,688408,688426,688448,688488,688496,688502,688503,688508,688510,688515,688516,688533,688536,688558,688566,688580,688588,688599,688601,688607,688633,688656,688661,688670,688678,688685,688689,688690,688697,688698,688700,688711,688800"
        ]
for scode in scodes:
    params = {
        'scode': scode,
        "@column": "SECCODE,SECNAME,F004V,F015V,F016V,F024V,F002D,ORGNAME,F025V,F003V"
    }
    records = requests.post(url, params=params, headers=headers).json()['records']
    for record in records:
        print(record)
        res = f"{record['SECCODE']} {record['SECNAME'].replace(' ','')} {record['F024V']} {record['F002D']} {record['F004V']} {record['ORGNAME']} {record['F025V']} {record['F003V']} {record['F015V']} {record['F016V']}"
        saveInfo(res)
